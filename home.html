<!DOCTYPE html>
<html>

<head>
  <title>Platform Newsroom</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <style>
    .container-table {
      margin-top: 15px;
      margin-bottom: 20px;
    }

    .container-table .table {
      cursor: pointer;
    }

    .navbar{
      background-color: #e3f2fd;
    }

    #container {
      display: flex;
    }

  .col-md-5 {
    flex: 0 0 50%; 
    margin-top: 10px;
    padding-right: 10px;
  }

  .details-container {
    display: flex;
  }

  #details {
    position:absolute; /* Change position to sticky */
    top: 0; /* Top position in px */
    transition: top 0.3s ease;
    flex: 1;
    background-color: #fff;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 10px;
  }
  .details-hidden {
      display: none;
    }

  .tab-heading {
    display: inline-block;
  }

  .refresh-button {
    display: inline-block;
    font-size: 12px; /* Adjust the font size as desired */
    padding: 5px 10px; /* Adjust the padding as desired */
  }


  
  </style>
</head>

<body>

  <!-- nav 메뉴 구역 -->
  <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-rocket-takeoff" viewBox="0 0 16 16">
            <path d="M9.752 6.193c.599.6 1.73.437 2.528-.362.798-.799.96-1.932.362-2.531-.599-.6-1.73-.438-2.528.361-.798.8-.96 1.933-.362 2.532Z"/>
            <path d="M15.811 3.312c-.363 1.534-1.334 3.626-3.64 6.218l-.24 2.408a2.56 2.56 0 0 1-.732 1.526L8.817 15.85a.51.51 0 0 1-.867-.434l.27-1.899c.04-.28-.013-.593-.131-.956a9.42 9.42 0 0 0-.249-.657l-.082-.202c-.815-.197-1.578-.662-2.191-1.277-.614-.615-1.079-1.379-1.275-2.195l-.203-.083a9.556 9.556 0 0 0-.655-.248c-.363-.119-.675-.172-.955-.132l-1.896.27A.51.51 0 0 1 .15 7.17l2.382-2.386c.41-.41.947-.67 1.524-.734h.006l2.4-.238C9.005 1.55 11.087.582 12.623.208c.89-.217 1.59-.232 2.08-.188.244.023.435.06.57.093.067.017.12.033.16.045.184.06.279.13.351.295l.029.073a3.475 3.475 0 0 1 .157.721c.055.485.051 1.178-.159 2.065Zm-4.828 7.475.04-.04-.107 1.081a1.536 1.536 0 0 1-.44.913l-1.298 1.3.054-.38c.072-.506-.034-.993-.172-1.418a8.548 8.548 0 0 0-.164-.45c.738-.065 1.462-.38 2.087-1.006ZM5.205 5c-.625.626-.94 1.351-1.004 2.09a8.497 8.497 0 0 0-.45-.164c-.424-.138-.91-.244-1.416-.172l-.38.054 1.3-1.3c.245-.246.566-.401.91-.44l1.08-.107-.04.039Zm9.406-3.961c-.38-.034-.967-.027-1.746.163-1.558.38-3.917 1.496-6.937 4.521-.62.62-.799 1.34-.687 2.051.107.676.483 1.362 1.048 1.928.564.565 1.25.941 1.924 1.049.71.112 1.429-.067 2.048-.688 3.079-3.083 4.192-5.444 4.556-6.987.183-.771.18-1.345.138-1.713a2.835 2.835 0 0 0-.045-.283 3.078 3.078 0 0 0-.3-.041Z"/>
            <path d="M7.009 12.139a7.632 7.632 0 0 1-1.804-1.352A7.568 7.568 0 0 1 3.794 8.86c-1.102.992-1.965 5.054-1.839 5.18.125.126 3.936-.896 5.054-1.902Z"/>
          </svg>
        Platform News</a>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/home" onclick="loadHome(event)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
            <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z"/>
            </svg>
            Home
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/search"> 
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
          </svg>
            Search</a>
        </li>
      </ul>
    </div>
  </nav>
  
  <!-- Tab 구역 -->
  <div class="row">
    <div class="col-md-7">
      <div class="tabs" style="margin-top: 10px;">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link active" id="tab-mts" data-toggle="tab" href="#tab-content-mts">MTS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="tab-mydata" data-toggle="tab" href="#tab-content-mydata">마이데이터</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="tab-sto" data-toggle="tab" href="#tab-content-sto">STO&토큰증권</a>
          </li>
        </ul>
  
        <!-- Tab content -->
        <div class="tab-content">
          <div class="tab-pane fade show active" id="tab-content-mts">
            <!-- MTS content -->
            <div class="container-table">
              <h2>MTS </h2>
              마지막 업데이트 일자: <span id="last-refreshed-mts"></span>
              <button class="btn btn-sm btn-primary refresh-button" onclick="refreshData('MTS')">업데이트</button>
              <table class="table">
                <thead>
                  <tr>
                    <th>기사 제목</th>
                    <th>일자</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in data.mts %}
                  <tr onclick="toggleDetails(event, `{{ item.title }}`, '{{ item.date }}','{{ item.press }}','{{ item.time }}','{{ item.url }}',`{{item.main_article}}`,`{{item.summary}}` )">
                    <td>{{ item.title }}</td>
                    <td>{{ item.date }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
  
          <div class="tab-pane fade" id="tab-content-mydata">
            <!-- 마이데이터 content -->
            <div class="container-table">
              <h2>마이데이터</h2>
              마지막 업데이트 일자: <span id="last-refreshed-mydata"></span>
              <button class="btn btn-sm btn-primary refresh-button" onclick="refreshData('마이데이터')">업데이트</button>
              <table class="table">
                <thead>
                  <tr>
                    <th>기사 제목</th>
                    <th>일자</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in data.mydata %}
                  <tr onclick="toggleDetails(event,`{{ item.title }}`, '{{ item.date }}','{{ item.press }}','{{ item.time }}','{{ item.url }}',`{{item.main_article}}`,`{{item.summary}}`)">
                    <td>{{ item.title }}</td>
                    <td>{{ item.date }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
  
          <div class="tab-pane fade" id="tab-content-sto">
            <!-- STO&토큰증권 content -->
            <div class="container-table">
              <h2>STO&토큰증권</h2>
              마지막 업데이트 일자: <span id="last-refreshed-sto"></span>
              <button class="btn btn-sm btn-primary refresh-button" onclick="refreshData('STO')">업데이트</button>
              <table class="table">
                <thead>
                  <tr>
                    <th>기사 제목</th>
                    <th>일자</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in data.sto %}
                  <tr onclick="toggleDetails(event,`{{ item.title }}`, '{{ item.date }}','{{ item.press }}','{{ item.time }}','{{ item.url }}', `{{item.main_article}}`,`{{item.summary}}`)">
                    <td>{{ item.title }}</td>
                    <td>{{ item.date }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--toggle 시 상세 정보 구역-->
    <div class="col-md-5">
      <div class="details-container">
        <div id="details" class="details-hidden"></div>
      </div>
    </div>

      
    </div>
  </div>
  
  <script>

function loadHome(event) {
  event.preventDefault(); // Prevent page from reloading

  // Make a GET request to the '/home' route to fetch the data
  fetch('/home')
    .then(response => response.json())
    .then(data => {
      data = data.replaceAll('`', "'");

      // Register event listeners for the toggleDetails function
      $('table.table tbody tr').click(function(event) {
        var selectedRowId = $(this).find('td').first().text();
        toggleDetails(event, selectedRowId);
      });
    })
    .catch(error => {
      console.error('Error:', error);
    });
}

function toggleDetails(event, title, date, press, time, url, article, summary) {
  event.preventDefault(); // Prevent page from reloading

  $('#details').empty(); // Clear the details div
  var detailsHtml = `
    <h3>Details</h3>
    <p>기사제목: ${title}</p>
    <p>언론사: ${press}</p>
    <p>일자: ${date} ${time}</p>
    <p>원본url: ${url}</p>
    <p>요약:${summary}</p>
    <p>본문:${article}</p>
  `;
  $('#details').html(detailsHtml);

  // Calculate the top position of the clicked row
  var topPosition = $(event.currentTarget).position().top;

  // Set the top position of the details div
  $('#details').css('top', topPosition);
  // Show the details div
  $('#details').removeClass('details-hidden');
}

  //업데이트 클릭 시 db 업데이트
  function refreshData(keyword) {
    const normKeyword = keyword.toUpperCase(); // Convert tabId to uppercase
    fetch('/refresh', {
      method: 'POST',
      body: JSON.stringify({ tab: normKeyword }),
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (response.ok) {
      // Refresh successful, update the last refreshed datetime
      const currentDatetime = new Date().toLocaleString();
      localStorage.setItem(`lastRefreshed-${normKeyword}`, currentDatetime)
      location.reload();
    } else {
      console.error('업데이트 실패');
    }
    fetch('/last_refreshed')
        .then(response => response.json())
        .then(data => {
          // Update the last refresh element with the retrieved timestamps
          document.getElementById('last-refreshed-mts').textContent = data.MTS;
          document.getElementById('last-refreshed-mydata').textContent = data.마이데이터;
          document.getElementById('last-refreshed-sto').textContent = data.STO;
        })
        .catch(error => console.error('Error:', error));
  })
    .catch(error => {
      console.error('업데이트 실패', error);
    });
  }

    // Retrieve last refreshed datetime from local storage and display it
  const lastRefreshedMTS = localStorage.getItem('lastRefreshed-MTS');
  if (lastRefreshedMTS) {
    document.getElementById('last-refreshed-mts').textContent = lastRefreshedMTS;
  }
  const lastRefreshedMydata = localStorage.getItem('lastRefreshed-마이데이터');
  if (lastRefreshedMydata) {
    document.getElementById('last-refreshed-mydata').textContent = lastRefreshedMydata;
  } 
  const lastRefreshedSTO = localStorage.getItem('lastRefreshed-STO');
  if (lastRefreshedSTO) {
    document.getElementById('last-refreshed-sto').textContent = lastRefreshedSTO;
  } 


  
  </script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>


</body>

</html>
