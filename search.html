<!DOCTYPE html>
<html>

<head>
  <title>Platform Newsroom - Search</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <style>
    .container-table {
      margin-bottom: 20px;
    }

    .container-table .table {
      cursor: pointer;
    }

    .navbar{
      background-color: #e3f2fd;
    }

    .loader {
      border: 8px solid #f3f3f3; /* Light gray border */
      border-top: 8px solid #3498db; /* Blue border */
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite; /* Animation to rotate the loader */
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    
  </style>
</head>

<body>
  
  <!-- nav 메뉴 구역 -->
  <nav class="navbar navbar-expand-lg" w-100>
    <a class="navbar-brand" href="/" onclick="">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-rocket-takeoff" viewBox="0 0 16 16">
            <path d="M9.752 6.193c.599.6 1.73.437 2.528-.362.798-.799.96-1.932.362-2.531-.599-.6-1.73-.438-2.528.361-.798.8-.96 1.933-.362 2.532Z"/>
            <path d="M15.811 3.312c-.363 1.534-1.334 3.626-3.64 6.218l-.24 2.408a2.56 2.56 0 0 1-.732 1.526L8.817 15.85a.51.51 0 0 1-.867-.434l.27-1.899c.04-.28-.013-.593-.131-.956a9.42 9.42 0 0 0-.249-.657l-.082-.202c-.815-.197-1.578-.662-2.191-1.277-.614-.615-1.079-1.379-1.275-2.195l-.203-.083a9.556 9.556 0 0 0-.655-.248c-.363-.119-.675-.172-.955-.132l-1.896.27A.51.51 0 0 1 .15 7.17l2.382-2.386c.41-.41.947-.67 1.524-.734h.006l2.4-.238C9.005 1.55 11.087.582 12.623.208c.89-.217 1.59-.232 2.08-.188.244.023.435.06.57.093.067.017.12.033.16.045.184.06.279.13.351.295l.029.073a3.475 3.475 0 0 1 .157.721c.055.485.051 1.178-.159 2.065Zm-4.828 7.475.04-.04-.107 1.081a1.536 1.536 0 0 1-.44.913l-1.298 1.3.054-.38c.072-.506-.034-.993-.172-1.418a8.548 8.548 0 0 0-.164-.45c.738-.065 1.462-.38 2.087-1.006ZM5.205 5c-.625.626-.94 1.351-1.004 2.09a8.497 8.497 0 0 0-.45-.164c-.424-.138-.91-.244-1.416-.172l-.38.054 1.3-1.3c.245-.246.566-.401.91-.44l1.08-.107-.04.039Zm9.406-3.961c-.38-.034-.967-.027-1.746.163-1.558.38-3.917 1.496-6.937 4.521-.62.62-.799 1.34-.687 2.051.107.676.483 1.362 1.048 1.928.564.565 1.25.941 1.924 1.049.71.112 1.429-.067 2.048-.688 3.079-3.083 4.192-5.444 4.556-6.987.183-.771.18-1.345.138-1.713a2.835 2.835 0 0 0-.045-.283 3.078 3.078 0 0 0-.3-.041Z"/>
            <path d="M7.009 12.139a7.632 7.632 0 0 1-1.804-1.352A7.568 7.568 0 0 1 3.794 8.86c-1.102.992-1.965 5.054-1.839 5.18.125.126 3.936-.896 5.054-1.902Z"/>
          </svg>
          Platform News</a>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/home">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
            <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z"/>
            </svg>
            Home
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/search" onclick="loadSearch()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
          </svg>
            Search</a>
        </li>
      </ul>
    </div>
  </nav>

  <!--content 구역-->
  <div class="container mt-4">
    <div class="row">
      <h2>Search Page</h2>
      <!--입력 구역-->
      <div class="input-group">
        <input type="text" id="searchInput" class="form-control" placeholder="검색할 키워드를 입력해주세요" onkeydown="handleKeyDown(event)">
        <div class="search_btn">
          <button class="btn btn-primary ml-3" type="button" onclick="search()">Search</button>
        </div>
      </div>
      <!--검색결과 구역-->
      <div class="col-md-7" style="margin-top: 20px;">
        <div id="searchResults"></div>
      </div>
    <!--toggle 시 상세 정보 구역-->
    <div class="col-md-5" style="margin-top: 20px;">
            <div id="detailsContainer">
            <div id="details"></div>
    </div>
</div>
  
    </div>
  </div>

  <script>
    // Function to handle the enter key being pressed
    function handleKeyDown(event) {
        if (event.key === "Enter") {
        search();
        }
    }

  // Function to search for results
  function search() {
    var searchInput = $('#searchInput').val();
    // Show the loading indicator
    $('#searchResults').html('<div class="loader"></div>');

    $.post('/search', { keyword: searchInput }, function(data) {
      // Convert the JSON string data to an array of objects
      var results = JSON.parse(data);
      var resultsHtml = ' ';

      // Generate the HTML for the search results table
      if (results.length > 0) {
        resultsHtml += '<table class="table"><thead><tr><th>기사 제목</th><th>일자</th></tr></thead><tbody>';
        for (var i = 0; i < results.length; i++) {
          var item = results[i];
          //var mainArticle = item.main_article.replace(/'/g, "\\'");
          var escapedArticle = JSON.stringify(item.main_article);
          resultsHtml += '<tr onclick="toggleDetails(event,\'' + item.title + '\', \'' + item.date + '\', \'' + item.press + '\', \'' + item.time + '\', \'' + item.url + '\')">';
          resultsHtml += '<td>' + item.title + '</td>';
          resultsHtml += '<td>' + item.date + '</td>';
          resultsHtml += '</tr>';
        }
        resultsHtml += '</tbody></table>';
      } else {
        resultsHtml = '<p>No results found.</p>';
      }

      $('#searchResults').html(resultsHtml);
    });
  }

  function toggleDetails(event, title, date, press, time, url) {
  event.preventDefault(); // Prevent page from reloading
  
  $('#details').empty(); // Clear the details div
    var detailsHtml = `
      <h3>Details</h3>
      <p>기사제목: ${title}</p>
      <p>언론사: ${press}</p>
      <p>일자: ${date} ${time}</p>
      <p>원본url: ${url}</p>
      
    `;
    $('#details').html(detailsHtml);
  }

</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

</body>

</html>
